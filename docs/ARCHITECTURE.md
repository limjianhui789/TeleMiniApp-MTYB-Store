# MTYB Virtual Goods Platform - Architecture Design

## é¡¹ç›®æ¦‚è¿°

MTYB Virtual Goods Platform æ˜¯ä¸€ä¸ªåŸºäº Telegram Mini App çš„è™šæ‹Ÿå•†å“è´­ä¹°å¹³å°ï¼Œé‡‡ç”¨æ’ä»¶åŒ–æ¶æ„è®¾è®¡ï¼Œæ”¯æŒå¤šç§ç±»å‹çš„è™šæ‹Ÿå•†å“é”€å”®å’Œè‡ªåŠ¨åŒ–äº¤ä»˜ã€‚

## æ ¸å¿ƒç‰¹æ€§

- ğŸ”Œ **æ’ä»¶åŒ–æ¶æ„** - æ”¯æŒä¸åŒç±»å‹äº§å“çš„ç‹¬ç«‹æ’ä»¶å¼€å‘
- ğŸ’³ **Curlec æ”¯ä»˜é›†æˆ** - é›†æˆ Curlec æ”¯ä»˜ç½‘å…³
- ğŸ¤– **è‡ªåŠ¨åŒ–äº¤ä»˜** - æ”¯ä»˜å®Œæˆåè‡ªåŠ¨å¤„ç†è®¢å•äº¤ä»˜
- ğŸ“± **Telegram åŸç”Ÿä½“éªŒ** - å®Œå…¨é›†æˆ Telegram Mini App åŠŸèƒ½
- ğŸ” **å®‰å…¨å¯é ** - å®Œæ•´çš„è®¢å•ç®¡ç†å’Œæ”¯ä»˜éªŒè¯ç³»ç»Ÿ

## ç³»ç»Ÿæ¶æ„

### 1. æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Telegram Mini App                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                     Frontend Layer                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚   Product   â”‚ â”‚   Order     â”‚ â”‚   Payment   â”‚           â”‚
â”‚  â”‚   Pages     â”‚ â”‚   Pages     â”‚ â”‚   Pages     â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                      Core System                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚   Product   â”‚ â”‚   Order     â”‚ â”‚   Payment   â”‚           â”‚
â”‚  â”‚  Manager    â”‚ â”‚  Manager    â”‚ â”‚  Gateway    â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                         â”‚                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              Plugin Manager                             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    Plugin Layer                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚     VPN     â”‚ â”‚   Netflix   â”‚ â”‚    Steam    â”‚           â”‚
â”‚  â”‚   Plugin    â”‚ â”‚   Plugin    â”‚ â”‚   Plugin    â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                   External Services                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚   Curlec    â”‚ â”‚   Target    â”‚ â”‚   KeyAuth   â”‚           â”‚
â”‚  â”‚  Payment    â”‚ â”‚   Servers   â”‚ â”‚   System    â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. æ ¸å¿ƒç»„ä»¶

#### 2.1 Frontend Layer (å‰ç«¯å±‚)
- **Product Pages**: äº§å“å±•ç¤ºã€åˆ†ç±»ã€æœç´¢
- **Order Pages**: è®¢å•ç®¡ç†ã€å†å²è®°å½•ã€çŠ¶æ€è·Ÿè¸ª
- **Payment Pages**: æ”¯ä»˜æµç¨‹ã€æ”¯ä»˜çŠ¶æ€ã€æ”¶æ®

#### 2.2 Core System (æ ¸å¿ƒç³»ç»Ÿ)
- **Product Manager**: äº§å“ç®¡ç†ã€åº“å­˜æ§åˆ¶ã€ä»·æ ¼ç®¡ç†
- **Order Manager**: è®¢å•åˆ›å»ºã€çŠ¶æ€ç®¡ç†ã€äº¤ä»˜åè°ƒ
- **Payment Gateway**: Curlec æ”¯ä»˜é›†æˆã€æ”¯ä»˜éªŒè¯ã€é€€æ¬¾å¤„ç†
- **Plugin Manager**: æ’ä»¶æ³¨å†Œã€ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€é€šä¿¡åè°ƒ

#### 2.3 Plugin Layer (æ’ä»¶å±‚)
- **Base Plugin Interface**: ç»Ÿä¸€çš„æ’ä»¶æ¥å£è§„èŒƒ
- **Product-Specific Plugins**: å„ç±»äº§å“çš„ä¸“ç”¨æ’ä»¶
- **Plugin Registry**: æ’ä»¶æ³¨å†Œå’Œå‘ç°æœºåˆ¶

## æ’ä»¶ç³»ç»Ÿè®¾è®¡

### 1. æ’ä»¶æ¥å£è§„èŒƒ

```typescript
interface BasePlugin {
  // æ’ä»¶é…ç½®
  config: PluginConfig;
  
  // ç”Ÿå‘½å‘¨æœŸæ–¹æ³•
  initialize(config: Record<string, any>): Promise<void>;
  validateConfig(config: Record<string, any>): Promise<ValidationResult>;
  
  // æ ¸å¿ƒåŠŸèƒ½
  processOrder(context: PluginContext): Promise<DeliveryResult>;
  validateProduct(productData: Record<string, any>): Promise<ValidationResult>;
  
  // å¯é€‰é’©å­
  onOrderCreated?(context: PluginContext): Promise<void>;
  onPaymentCompleted?(context: PluginContext): Promise<void>;
  onOrderCancelled?(context: PluginContext): Promise<void>;
  
  // å¥åº·æ£€æŸ¥
  healthCheck?(): Promise<boolean>;
}
```

### 2. æ’ä»¶ç±»å‹ç¤ºä¾‹

#### VPN Plugin
- **åŠŸèƒ½**: è¿æ¥åˆ° VPN æœåŠ¡å™¨ API åˆ›å»ºç”¨æˆ·è´¦æˆ·
- **é…ç½®**: API ç«¯ç‚¹ã€è®¤è¯å¯†é’¥ã€æœåŠ¡å™¨åˆ—è¡¨
- **äº¤ä»˜**: ç”¨æˆ·åã€å¯†ç ã€æœåŠ¡å™¨é…ç½®æ–‡ä»¶

#### Netflix Plugin  
- **åŠŸèƒ½**: é€šè¿‡é‚®ä»¶ç³»ç»Ÿè·å–è´¦æˆ·ä¿¡æ¯
- **é…ç½®**: é‚®ä»¶æœåŠ¡å™¨ã€è´¦æˆ·æ± ç®¡ç†
- **äº¤ä»˜**: è´¦æˆ·é‚®ç®±ã€å¯†ç ã€ä½¿ç”¨è¯´æ˜

#### Steam Plugin
- **åŠŸèƒ½**: é›†æˆ KeyAuth ç³»ç»Ÿè·å–æ¸¸æˆå¯†é’¥
- **é…ç½®**: KeyAuth APIã€äº§å“æ˜ å°„
- **äº¤ä»˜**: æ¸¸æˆæ¿€æ´»ç ã€å®‰è£…è¯´æ˜

### 3. æ’ä»¶å¼€å‘è§„èŒƒ

```typescript
// æ’ä»¶å¼€å‘æ¨¡æ¿
export class CustomPlugin extends BasePlugin {
  config = {
    id: 'custom-plugin',
    name: 'Custom Product Plugin',
    version: '1.0.0',
    category: ProductCategory.OTHER,
    // ... å…¶ä»–é…ç½®
  };

  async initialize(config: Record<string, any>) {
    // åˆå§‹åŒ–é€»è¾‘
  }

  async processOrder(context: PluginContext): Promise<DeliveryResult> {
    // è®¢å•å¤„ç†é€»è¾‘
    return {
      success: true,
      deliveryData: {
        // äº¤ä»˜æ•°æ®
      }
    };
  }

  // ... å…¶ä»–å¿…éœ€æ–¹æ³•
}
```

## æ•°æ®æ¨¡å‹è®¾è®¡

### 1. æ ¸å¿ƒå®ä½“

```typescript
// ç”¨æˆ·æ¨¡å‹
interface User {
  id: string;
  telegramId: number;
  username?: string;
  firstName?: string;
  lastName?: string;
  languageCode?: string;
  createdAt: Date;
  updatedAt: Date;
}

// äº§å“æ¨¡å‹
interface Product {
  id: string;
  name: string;
  description: string;
  price: number;
  currency: string;
  category: ProductCategory;
  pluginId: string;
  isActive: boolean;
  metadata: Record<string, any>;
  createdAt: Date;
  updatedAt: Date;
}

// è®¢å•æ¨¡å‹
interface Order {
  id: string;
  userId: string;
  productId: string;
  quantity: number;
  totalAmount: number;
  currency: string;
  status: OrderStatus;
  paymentId?: string;
  deliveryData?: Record<string, any>;
  metadata: Record<string, any>;
  createdAt: Date;
  updatedAt: Date;
}
```

### 2. çŠ¶æ€ç®¡ç†

```typescript
enum OrderStatus {
  PENDING = 'pending',           // å¾…æ”¯ä»˜
  PROCESSING = 'processing',     // å¤„ç†ä¸­
  COMPLETED = 'completed',       // å·²å®Œæˆ
  FAILED = 'failed',            // å¤±è´¥
  REFUNDED = 'refunded'         // å·²é€€æ¬¾
}

enum ProductCategory {
  VPN = 'vpn',
  STREAMING = 'streaming',
  GAMING = 'gaming',
  SOFTWARE = 'software',
  OTHER = 'other'
}
```

## æ”¯ä»˜æµç¨‹è®¾è®¡

### 1. æ”¯ä»˜æµç¨‹å›¾

```
ç”¨æˆ·é€‰æ‹©äº§å“ â†’ åˆ›å»ºè®¢å• â†’ å‘èµ·æ”¯ä»˜ â†’ Curlecå¤„ç† â†’ æ”¯ä»˜å›è°ƒ â†’ æ’ä»¶å¤„ç† â†’ äº¤ä»˜å®Œæˆ
     â”‚              â”‚           â”‚           â”‚           â”‚           â”‚           â”‚
     â–¼              â–¼           â–¼           â–¼           â–¼           â–¼           â–¼
  äº§å“éªŒè¯      è®¢å•åˆ›å»º    æ”¯ä»˜é¡µé¢    æ”¯ä»˜éªŒè¯    çŠ¶æ€æ›´æ–°    è‡ªåŠ¨äº¤ä»˜    ç”¨æˆ·é€šçŸ¥
```

### 2. Curlec é›†æˆè¦ç‚¹

- **æ”¯ä»˜åˆ›å»º**: è°ƒç”¨ Curlec API åˆ›å»ºæ”¯ä»˜è¯·æ±‚
- **å›è°ƒå¤„ç†**: å¤„ç†æ”¯ä»˜æˆåŠŸ/å¤±è´¥çš„ Webhook å›è°ƒ
- **ç­¾åéªŒè¯**: éªŒè¯ Webhook ç­¾åç¡®ä¿å®‰å…¨æ€§
- **çŠ¶æ€åŒæ­¥**: å®æ—¶åŒæ­¥æ”¯ä»˜çŠ¶æ€åˆ°è®¢å•ç³»ç»Ÿ
- **é€€æ¬¾å¤„ç†**: æ”¯æŒè®¢å•é€€æ¬¾å’Œéƒ¨åˆ†é€€æ¬¾

## å®‰å…¨è€ƒè™‘

### 1. æ•°æ®å®‰å…¨
- æ•æ„Ÿé…ç½®ä¿¡æ¯åŠ å¯†å­˜å‚¨
- API å¯†é’¥å®‰å…¨ç®¡ç†
- ç”¨æˆ·æ•°æ®éšç§ä¿æŠ¤

### 2. æ”¯ä»˜å®‰å…¨
- Webhook ç­¾åéªŒè¯
- æ”¯ä»˜çŠ¶æ€åŒé‡éªŒè¯
- é˜²é‡å¤æ”¯ä»˜æœºåˆ¶

### 3. æ’ä»¶å®‰å…¨
- æ’ä»¶æ²™ç®±æ‰§è¡Œç¯å¢ƒ
- é…ç½®éªŒè¯å’Œæ¸…ç†
- é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•

## æŠ€æœ¯æ ˆ

### Frontend
- **React 18** - ç”¨æˆ·ç•Œé¢æ¡†æ¶
- **TypeScript** - ç±»å‹å®‰å…¨
- **Telegram UI** - åŸç”Ÿ Telegram ç»„ä»¶
- **React Router** - è·¯ç”±ç®¡ç†
- **Vite** - æ„å»ºå·¥å…·

### Core System
- **Plugin Architecture** - æ’ä»¶åŒ–æ¶æ„
- **State Management** - çŠ¶æ€ç®¡ç†
- **API Integration** - å¤–éƒ¨æœåŠ¡é›†æˆ

### External Services
- **Curlec Payment Gateway** - æ”¯ä»˜å¤„ç†
- **Telegram Bot API** - æ¶ˆæ¯é€šçŸ¥
- **Various Product APIs** - äº§å“ç‰¹å®šæœåŠ¡

## éƒ¨ç½²æ¶æ„

### 1. å¼€å‘ç¯å¢ƒ
- æœ¬åœ°å¼€å‘æœåŠ¡å™¨ (Vite)
- Mock æ”¯ä»˜ç½‘å…³
- æ’ä»¶çƒ­é‡è½½

### 2. ç”Ÿäº§ç¯å¢ƒ
- GitHub Pages é™æ€æ‰˜ç®¡
- CDN åŠ é€Ÿ
- ç¯å¢ƒå˜é‡ç®¡ç†
- ç›‘æ§å’Œæ—¥å¿—

## æ‰©å±•æ€§è®¾è®¡

### 1. æ°´å¹³æ‰©å±•
- æ’ä»¶ç‹¬ç«‹å¼€å‘å’Œéƒ¨ç½²
- å¾®æœåŠ¡æ¶æ„æ”¯æŒ
- API ç‰ˆæœ¬ç®¡ç†

### 2. åŠŸèƒ½æ‰©å±•
- æ–°äº§å“ç±»å‹å¿«é€Ÿæ¥å…¥
- å¤šæ”¯ä»˜ç½‘å…³æ”¯æŒ
- å¤šè¯­è¨€å›½é™…åŒ–

### 3. æ€§èƒ½ä¼˜åŒ–
- ç»„ä»¶æ‡’åŠ è½½
- æ•°æ®ç¼“å­˜ç­–ç•¥
- æ‰¹é‡æ“ä½œæ”¯æŒ
